<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Chapter12 ：Piecewise by categorical interactions - Alex_Wang</title><meta name="Description" content="This chapter illustrates how to fit models in which a continuous variable, fit in a piecewise manner, is interacted with a categorical variable.  "><meta property="og:title" content="Chapter12 ：Piecewise by categorical interactions" />
<meta property="og:description" content="This chapter illustrates how to fit models in which a continuous variable, fit in a piecewise manner, is interacted with a categorical variable.  " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://forest293.github.io/12.chapter12piecewise-by-categorical-interactions/" /><meta property="og:image" content="https://forest293.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-11T16:29:41+08:00" />
<meta property="article:modified_time" content="2024-01-11T23:45:40+08:00" /><meta property="og:site_name" content="Alex_Wang" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://forest293.github.io/logo.png"/>

<meta name="twitter:title" content="Chapter12 ：Piecewise by categorical interactions"/>
<meta name="twitter:description" content="This chapter illustrates how to fit models in which a continuous variable, fit in a piecewise manner, is interacted with a categorical variable.  "/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://forest293.github.io/12.chapter12piecewise-by-categorical-interactions/" /><link rel="prev" href="https://forest293.github.io/13.chapter13continuous-by-continuous-by-categorical-interactions/" /><link rel="next" href="https://forest293.github.io/16.chapter16time-as-a-continuous-predictor/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Chapter12 ：Piecewise by categorical interactions",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/forest293.github.io\/12.chapter12piecewise-by-categorical-interactions\/"
        },"image": ["https:\/\/forest293.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "Interaction, stata","wordcount":  5475 ,
        "url": "https:\/\/forest293.github.io\/12.chapter12piecewise-by-categorical-interactions\/","datePublished": "2024-01-11T16:29:41+08:00","dateModified": "2024-01-11T23:45:40+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/forest293.github.io\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "Alex_Wang"
            },"description": "This chapter illustrates how to fit models in which a continuous variable, fit in a piecewise manner, is interacted with a categorical variable.  "
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Alex_Wang">Alex Wang</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/categories/documentation/"> 文档 </a><a class="menu-item" href="/about/"> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="选择语言">
                    <i class="fa fa-globe" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/12.chapter12piecewise-by-categorical-interactions/" selected>简体中文</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Alex_Wang">Alex Wang</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/categories/documentation/" title="">文档</a><a class="menu-item" href="/about/" title="">关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="选择语言">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/12.chapter12piecewise-by-categorical-interactions/" selected>简体中文</option></select>
                </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Chapter12 ：Piecewise by categorical interactions</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Alex_Wang</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/interpreting-and-visualizing-regression-models-using-stata/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Interpreting and Visualizing Regression Models Using Stata</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-01-11">2024-01-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;约 5475 字&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;预计阅读 11 分钟&nbsp;<span id="/12.chapter12piecewise-by-categorical-interactions/" class="leancloud_visitors" data-flag-title="Chapter12 ：Piecewise by categorical interactions">
                        <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-one-knot-and-one-jump">1 One knot and one jump</a>
      <ul>
        <li><a href="#11-comparing-slopes-across-gender">1.1 Comparing slopes across gender</a></li>
        <li><a href="#12-comparing-slopes-across-education">1.2 Comparing slopes across education</a></li>
        <li><a href="#13-difference-in-differences-of-slopesgain-in-slope">1.3 Difference in differences of slopes（gain in slope）</a></li>
        <li><a href="#14-comparing-changes-in-intercepts">1.4 Comparing changes in intercepts</a></li>
        <li><a href="#15-computing-and-comparing-adjusted-means">1.5 Computing and comparing adjusted means</a></li>
        <li><a href="#16-graphing-adjusted-means">1.6 Graphing adjusted means</a></li>
      </ul>
    </li>
    <li><a href="#2-two-knots-and-two-jumps">2 Two knots and two jumps</a>
      <ul>
        <li><a href="#21-comparing-slopes-across-gender-cross-section">2.1 Comparing slopes across gender (Cross Section)</a></li>
        <li><a href="#22-comparing-slopes-across-education">2.2 Comparing slopes across education</a></li>
        <li><a href="#23-difference-in-differences-of-slopes">2.3 Difference in differences of slopes</a></li>
        <li><a href="#24-comparing-changes-in-intercepts-by-gender">2.4 Comparing changes in intercepts by gender</a></li>
        <li><a href="#25-comparing-changes-in-intercepts-by-education">2.5 Comparing changes in intercepts by education</a></li>
        <li><a href="#26-computing-and-comparing-adjusted-means">2.6 Computing and comparing adjusted means</a></li>
        <li><a href="#27-graphing-adjusted-means">2.7 Graphing adjusted means</a></li>
      </ul>
    </li>
    <li><a href="#3-comparing-coding-schemes">3 Comparing coding schemes</a>
      <ul>
        <li><a href="#31-coding-scheme-1">3.1 Coding scheme #1</a></li>
        <li><a href="#32-coding-scheme-2">3.2 Coding scheme #2</a></li>
        <li><a href="#33-coding-scheme-3">3.3 Coding scheme #3</a></li>
        <li><a href="#34-coding-scheme-4">3.4 Coding scheme #4</a></li>
        <li><a href="#35-choosing-coding-schemes">3.5 Choosing coding schemes</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>This chapter illustrates how to fit models in which a continuous variable, fit in a piecewise manner, is interacted with a categorical variable.</p>
<h2 id="1-one-knot-and-one-jump">1 One knot and one jump</h2>
<p>For example, education was modeled in a piecewise manner including one knot at 12 years of education. This knot signifies both a change of slope and change in intercept (jump). The model also includes gender as a categorical variable and estimates separate slopes and intercepts for each level of gender</p>
<figure style="text-align:center;">
  <img src="https://cdn.jsdelivr.net/gh/forest293/Hugo-image/2024.1.11.12.png" style="width:550px;height:350px;" alt="图片描述">
  <figcaption><strong>Piecewise regression with one knot and one jump, labeled with estimated slopes</strong></figcaption>
</figure>
<p>Figure shows the adjusted means of income as a function of education with labels for each of the slopes. For men, the slope for non–high school graduates is labeled $\beta\tiny M1$ and the slope for high school graduates is labeled $\beta\tiny M2$ . For women, the slope for non–high school graduates is labeled $\beta\tiny F1$ and the slope for high school graduates is labeled $\beta\tiny F2$. The income jump at 12 years of education for men is labeled as $\alpha\tiny M1$. The corresponding jump at 12 years of education for women is labeled as $\alpha\tiny F1$. Note how an arrow head points to a sudden jump in income at 12 years of education</p>
<p>To fit this model, we will use separate slope and separate intercept coding with respect to the gender groups. This means that we will estimate separate intercept terms for men and women (this includes separate jumps,$\alpha\tiny M1$ and $\alpha\tiny F1$ ). It will also estimate separate slope terms for men (that is, $\beta\tiny M1$ and $\beta\tiny M2$ ) and separate slope terms for women (that is,$\beta\tiny F1$ and $\beta\tiny F2$).</p>
<p>We first use the mkspline command to create the variables ed1 and ed2 with a knot at 12 years of education.
the variables ed1 and ed2 will reflect the slopes of the individual line segments before and after the knot.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  mkspline ed1 12 ed2 = educ 
</span></span></code></pre></td></tr></table>
</div>
</div><p>We are now ready to run the piecewise regression model, shown in the regress command below. The regress command includes ibn.gender used in combination with the noconstant option to yield separate estimates of the intercept for each gender.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  reg realrinc ibn.gender ibn.gender#i.hsgrad ///
</span></span><span class="line"><span class="cl">               ibn.gender#c.ed1 ibn.gender#c.ed2 i.race, vce(robust) noconstant noci
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Linear regression                               Number of obs     =      3,126
                                                    F(6, 3120)        =     614.01
                                                    Prob &gt; F          =     0.0000
                                                    R-squared         =     0.5132
                                                    Root MSE          =      20860
    
    --------------------------------------------------------
                    |               Robust
           realrinc | Coefficient  std. err.      t    P&gt;|t|
    ----------------+---------------------------------------
             gender |
            Female  |   10502.44    1991.84     5.27   0.000
                    |
      gender#hsgrad |
    Female#HS Grad  |    2891.28     893.57     3.24   0.001
                    |
       gender#c.ed1 |
            Female  |      95.54     211.64     0.45   0.652
                    |
       gender#c.ed2 |
            Female  |    3260.42     247.08    13.20   0.000
                    |
               race |
             black  |   -1174.41     902.16    -1.30   0.193
             other  |   -4732.20    1169.14    -4.05   0.000
    --------------------------------------------------------
</code></pre>
<blockquote>
<p>Note! Model shortcut</p>
<blockquote>
<p>Stata expands the expression ibn.gender#(i.hsgrad c.ed1 c.ed2) to become ibn.gender#i.hsgrad ibn.gender#c.ed1 ibn.gender#c.ed2, yielding the same model we saw before.</p>
</blockquote>
</blockquote>
<ol>
<li>The first two columns of the table repeat the name and estimate of the coefficient from the regress output.</li>
<li>The third column shows the symbol used to represent the coefficient in figure above, providing a cross reference between the output of the regression model and figure.</li>
<li>The last column shows the symbolic name of the regression coefficient that we can use with the lincom command for making comparisons among the coefficients.</li>
</ol>
<figure style="text-align:center;">
  <img src="https://cdn.jsdelivr.net/gh/forest293/Hugo-image/2024.1.11.13.png" style="width:550px;height:350px;" alt="图片描述">
  <figcaption><strong>Summary of piecewise regression results with one knot</strong></figcaption>
</figure>
<p>Let’s begin by interpreting the change in intercept (jump) terms. The jump in the adjusted mean of income for men at 12 years of education is 3,382.01, and the corresponding jump for women is 1,748.10. Each of these jumps is statistically significant.</p>
<p>Let’s now interpret the slopes. For men, the educ slope is 86.71 for non–high school graduates and is 4,057.64 for high school graduates. For women, the slope is 241.61 for non–high school graduates and is 2,529.55 for high school graduates. Aside from the educ slope for male non–high school graduates (86.71), all of these slopes are significantly different from 0.</p>
<p>The following four sections will illustrate how to make a number of comparisons, showing how to:</p>
<ol>
<li><strong>compare slopes between women and men</strong></li>
<li><strong>compare slopes across the levels of education, comparing high school graduates with non–high school graduates</strong></li>
<li><strong>compare the changes in slope between men and women due to graduating high school</strong></li>
<li>**compare the jump in income due to graduating high school between men and women</li>
</ol>
<h3 id="11-comparing-slopes-across-gender">1.1 Comparing slopes across gender</h3>
<p>Let’s begin by testing the equality of the educ slopes of women and men who have not graduated high school. In other words, is $\beta\tiny F1$= $\beta\tiny M1$ ?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  contrast gender#c.ed1,pveffects nowald
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Contrasts of marginal linear predictions
    
    Margins: asbalanced
    
    ----------------------------------------------------------
                      |   Contrast   Std. err.      t    P&gt;|t|
    ------------------+---------------------------------------
         gender#c.ed1 |
    (Female vs base)  |     154.90     179.32     0.86   0.388
    ----------------------------------------------------------
</code></pre>
<p>Let’s compare the educ slopes of men and women for those who graduated high school by testing whether $\beta\tiny F2$ = $\beta\tiny M2$ .</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  contrast gender#c.ed2,pveffects nowald
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Contrasts of marginal linear predictions
    
    Margins: asbalanced
    
    ----------------------------------------------------------
                      |   Contrast   Std. err.      t    P&gt;|t|
    ------------------+---------------------------------------
         gender#c.ed2 |
    (Female vs base)  |   -1528.09     187.09    -8.17   0.000
    ----------------------------------------------------------
</code></pre>
<p>The difference in the slopes (women versus men) is $-1,528.09$. For every year of education beyond the 12th year, the income for men increases by $1,528.09$ more than for women.</p>
<h3 id="12-comparing-slopes-across-education">1.2 Comparing slopes across education</h3>
<p>let’s examine the change in slope between high school graduates and non–high school graduates for men. is $\beta\tiny M2$ = $\beta\tiny M1$ ?</p>
<p>As shown in table , the symbolic names for these coefficients are 1.gender#ed2 and 1.gender#ed1. We can compare these coefficients using the <strong>lincom command</strong>, as shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  lincom 1.gender#c.ed2 - 1.gender#c.ed1 
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>     ( 1)  - 1bn.gender#c.ed1 + 1bn.gender#c.ed2 = 0
    
    ------------------------------------------------------------------------------
        realrinc | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
    -------------+----------------------------------------------------------------
             (1) |    3970.93     212.70    18.67   0.000      3554.04     4387.83
    ------------------------------------------------------------------------------
</code></pre>
<p>Men show a significantly higher slope after graduating high school than men who have not graduated high school. The difference (comparing high school graduates with non–high school graduates) is 3,970.93.</p>
<p>We can formulate the same kind of test for women, comparing the educ slope for high school graduates with that for non–high school graduates.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  lincom 2.gender#c.ed2 - 2.gender#c.ed1
</span></span></code></pre></td></tr></table>
</div>
</div><p>Is $\beta\tiny F2$ = $\beta\tiny F1$ ?</p>
<pre><code>     ( 1)  - 2.gender#c.ed1 + 2.gender#c.ed2 = 0
    
    ------------------------------------------------------------------------------
        realrinc | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
    -------------+----------------------------------------------------------------
             (1) |    2287.94     147.26    15.54   0.000      1999.30     2576.58
    ------------------------------------------------------------------------------
</code></pre>
<h3 id="13-difference-in-differences-of-slopesgain-in-slope">1.3 Difference in differences of slopes（gain in slope）</h3>
<p>The previous section showed that, for men, the educ slope after graduating high school minus the slope before graduating high school equals 3,970.93. Let’s call this the gain in slope due to graduating high school. For women, the gain in slope due to graduating high school is 2,287.94.</p>
<p>We might ask if the gain in slope due to graduating high school differs by gender. The lincom command below tests the gain in slope for men compared with the gain in slope for women.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  lincom (1.gender#c.ed2 - 1.gender#c.ed1) - (2.gender#c.ed2 - 2.gender#c.ed1)
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>     ( 1)  - 1bn.gender#c.ed1 + 2.gender#c.ed1 + 1bn.gender#c.ed2 - 2.gender#c.ed2 = 0
    
    ------------------------------------------------------------------------------
        realrinc | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
    -------------+----------------------------------------------------------------
             (1) |    1682.99     259.29     6.49   0.000      1174.78     2191.20
    ------------------------------------------------------------------------------
</code></pre>
<h3 id="14-comparing-changes-in-intercepts">1.4 Comparing changes in intercepts</h3>
<p>Let’s now ask whether the jump in income at 12 years of education is equal for men and women.
the income for men jumps by $3,382.01$ at 12 years of education, whereas the corresponding jump for women is $1,748.10$. Are these jumps equal?</p>
<p>Is $\alpha\tiny F1$ = $\alpha\tiny M1$ ?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  contrast gender#hsgrad,pveffects nowald 
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Contrasts of marginal linear predictions
    
    Margins: asbalanced
    
    ----------------------------------------------------------------------------
                                        |   Contrast   Std. err.      t    P&gt;|t|
    ------------------------------------+---------------------------------------
                          gender#hsgrad |
    (Female vs base) (HS Grad vs base)  |   -1633.91     766.98    -2.13   0.033
    ----------------------------------------------------------------------------
</code></pre>
<p>Some people might find that this test is more intuitive if performed using the following lincom command below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  lincom 2.gender#1.hsgrad - 1.gender#1.hsgrad
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>     ( 1)  - 1bn.gender#1.hsgrad + 2.gender#1.hsgrad = 0
    
    ------------------------------------------------------------------------------
        realrinc | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
    -------------+----------------------------------------------------------------
             (1) |   -1633.91     766.98    -2.13   0.033     -3137.23     -130.59
    ------------------------------------------------------------------------------
</code></pre>
<h3 id="15-computing-and-comparing-adjusted-means">1.5 Computing and comparing adjusted means</h3>
<p>Let’s now turn our attention to how we can compute adjusted means for this regression model.</p>
<p>Before we can compute adjusted means with respect to education (that is, educ), we need to know how to express the level of education in terms of hsgrad, ed1, and ed2.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  showcoding educ hsgrad ed1 ed2  //the command is not fit for stata18
</span></span></code></pre></td></tr></table>
</div>
</div><figure style="text-align:center;">
  <img src="https://cdn.jsdelivr.net/gh/forest293/Hugo-image/2024.1.11.14.png" style="width:250px;height:350px;" alt="图片描述">
  <figcaption><strong> </strong></figcaption>
</figure>
<p>Let’s now estimate the adjusted mean for a female (that is, gender=2) with 15 years of education, as shown below. To indicate 15 years of education, we specify that hsgrad equals 1, ed1 equals 12, and ed2 equals 3.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  margins,nopvalues at(gender=2 hsgrad=1 ed1=12 ed2=3)  
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Predictive margins                                      Number of obs = 32,183
    Model VCE: Robust
    
    Expression: Linear prediction, predict()
    At: gender =  2
        hsgrad =  1
        ed1    = 12
        ed2    =  3
    
    --------------------------------------------------------------
                 |            Delta-method
                 |     Margin   std. err.     [95% conf. interval]
    -------------+------------------------------------------------
           _cons |   18993.22     234.17      18534.24    19452.20
    --------------------------------------------------------------
</code></pre>
<p>We can estimate the adjusted mean of income for men and women with 15 years of education using the margins command below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  margins gender,nopvalues at(hsgrad=1 ed1=12 ed2=3)  
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Predictive margins                                      Number of obs = 32,183
    Model VCE: Robust
    
    Expression: Linear prediction, predict()
    At: hsgrad =  1
        ed1    = 12
        ed2    =  3
    
    --------------------------------------------------------------
                 |            Delta-method
                 |     Margin   std. err.     [95% conf. interval]
    -------------+------------------------------------------------
          gender |
           Male  |   33171.77     351.09      32483.62    33859.93
         Female  |   18993.22     234.17      18534.24    19452.20
    --------------------------------------------------------------
</code></pre>
<p>Specifying the r. contrast operator indicates we want to use reference group comparisons, comparing the adjusted mean of income for women versus men.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  margins r.gender,at(hsgrad=1 ed1=12 ed2=3) contrast(nowald pveffects)
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Contrasts of predictive margins                         Number of obs = 32,183
    Model VCE: Robust
    
    Expression: Linear prediction, predict()
    At: hsgrad =  1
        ed1    = 12
        ed2    =  3
    
    ----------------------------------------------------------
                      |            Delta-method
                      |   Contrast   std. err.      t    P&gt;|t|
    ------------------+---------------------------------------
               gender |
    (Female vs Male)  |  -14178.55     422.06   -33.59   0.000
    ----------------------------------------------------------
</code></pre>
<h3 id="16-graphing-adjusted-means">1.6 Graphing adjusted means</h3>
<p>Let’s graph the adjusted means as a function of education and gender. To make this graph, we need to compute the adjusted means separately for men and women with 0 years of education, 12 years of education (assuming the absence and presence of a high school diploma), and 20 years of education.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  margins gender,at(hsgrad=0 ed1=0 ed2=0) ///
</span></span><span class="line"><span class="cl">                 at(hsgrad=0 ed1=12 ed2=0) ///
</span></span><span class="line"><span class="cl">				         at(hsgrad=1 ed1=12 ed2=0) ///
</span></span><span class="line"><span class="cl">				         at(hsgrad=1 ed1=12 ed2=8) nopvalues
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Predictive margins                                      Number of obs = 32,183
    Model VCE: Robust
    
    Expression: Linear prediction, predict()
    1._at: hsgrad =  0
           ed1    =  0
           ed2    =  0
    2._at: hsgrad =  0
           ed1    = 12
           ed2    =  0
    3._at: hsgrad =  1
           ed1    = 12
           ed2    =  0
    4._at: hsgrad =  1
           ed1    = 12
           ed2    =  8
    
    --------------------------------------------------------------
                 |            Delta-method
                 |     Margin   std. err.     [95% conf. interval]
    -------------+------------------------------------------------
      _at#gender |
         1#Male  |   16576.36    1384.62      13862.46    19290.26
       1#Female  |    6757.19     910.63       4972.32     8542.05
         2#Male  |   17616.85     590.78      16458.91    18774.80
       2#Female  |    9656.48     345.83       8978.65    10334.32
         3#Male  |   20998.86     297.50      20415.75    21581.96
       3#Female  |   11404.58     179.77      11052.22    11756.94
         4#Male  |   53459.97    1042.02      51417.56    55502.37
       4#Female  |   31640.96     761.69      30148.02    33133.90
    --------------------------------------------------------------
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  preserve
</span></span><span class="line"><span class="cl">  clear
</span></span><span class="line"><span class="cl">  input educ yhatm yhatf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  0 16576.36 6757.187
</span></span><span class="line"><span class="cl">  12 17616.85 9656.485
</span></span><span class="line"><span class="cl">  12 20998.86 11404.58
</span></span><span class="line"><span class="cl">  20 53459.97 31640.96
</span></span><span class="line"><span class="cl">end
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  graph twoway line yhatm yhatf educ,xline(12)legend(label(1 &#34;Men&#34;)label(2 &#34;Women&#34;)) ///
</span></span><span class="line"><span class="cl">               xtitle(Education)ytitle(Adjusted mean)
</span></span></code></pre></td></tr></table>
</div>
</div><figure style="text-align:center;">
  <img src="https://cdn.jsdelivr.net/gh/forest293/Hugo-image/2024.1.11.15.png" style="width:250px;height:350px;" alt="图片描述">
  <figcaption><strong>Fitted values from piecewise model with one knot and one jump at educ = 12</strong></figcaption>
</figure>
<p><strong>We can automate the creation of this graph by extending the strategy</strong></p>
<ol>
<li>First, we use the matrix command to create a matrix named yhat that contains the adjusted means computed by the margins command.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">**First,rerun the -margins- command from above
</span></span><span class="line"><span class="cl">  quietly margins gender, at(hsgrad=0 ed1=0 ed2=0) ///
</span></span><span class="line"><span class="cl">                          at(hsgrad=0 ed1=12 ed2=0) ///
</span></span><span class="line"><span class="cl">				                  at(hsgrad=1 ed1=12 ed2=0) ///
</span></span><span class="line"><span class="cl">				                  at(hsgrad=1 ed1=12 ed2=8) 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">** store the adjusted means in a matrix named -yhat-
</span></span><span class="line"><span class="cl">  matrix yhat = r(b)&#39;  //NOTE: We must use transpose here	
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, we encounter a twist because the adjusted means are computed as a function two variables (education and gender).</p>
<p>Looking at the output of the margins command, let’s focus on the order in which <strong>the adjusted means are displayed with respect to education and gender.</strong> Eight adjusted means are shown, corresponding to the following levels of educ, hsgrad, and gender:</p>
<ul>
<li>educ=0, hsgrad=0, gender=1</li>
<li>educ=0, hsgrad=0, gender=2</li>
<li>educ=12, hsgrad=0, gender=1</li>
<li>educ=12, hsgrad=0, gender=2</li>
<li>educ=12, hsgrad=1, gender=1</li>
<li>educ=12, hsgrad=1, gender=2</li>
<li>educ=20, hsgrad=1, gender=1</li>
<li>educ=20, hsgrad=1, gender=2</li>
</ul>
<p>The matrix command is used to create a matrix named educ that reflects the levels of education shown in the bulleted list above. The matrix command is used again, this time to create a matrix called gender that contains the levels of gender shown in the bulleted list above.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">* store levels of education in a matrix named -educ-
</span></span><span class="line"><span class="cl">  matrix educ = (0\0\12\12\12\12\20\20)
</span></span><span class="line"><span class="cl">* store levels of gender in a matrix named -gender-
</span></span><span class="line"><span class="cl">  matrix gender = (1\2\1\2\1\2\1\2)
</span></span></code></pre></td></tr></table>
</div>
</div><p>The svmat command is then used three times, to save the matrices named yhat, educ, and gender to the current dataset.</p>
<p>The list command is then used to show the variables yhat1, educ1, and gender1 for the first 10 observations of the dataset.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  svmat yhat  //save the matrix -yhat- to the current dataset
</span></span><span class="line"><span class="cl">  svmat educ  //save the matrix -educ- to the current dataset  
</span></span><span class="line"><span class="cl">  svmat gender  //save the matrix -gender- to the current dataset
</span></span><span class="line"><span class="cl">  list yhat1 educ1 gender1 in 1/10,sep(2)
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>         +----------------------------+
         |    yhat1   educ1   gender1 |
         |----------------------------|
      1. | 16576.36       0         1 |
      2. | 6757.188       0         2 |
         |----------------------------|
      3. | 17616.85      12         1 |
      4. | 9656.484      12         2 |
         |----------------------------|
      5. | 20998.86      12         1 |
      6. | 11404.58      12         2 |
         |----------------------------|
      7. | 53459.96      20         1 |
      8. | 31640.96      20         2 |
         |----------------------------|
      9. |        .       .         . |
     10. |        .       .         . |
         +----------------------------+
</code></pre>
<p>We are now ready to use the graph command to graph the adjusted means as afunction of education and gender.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  graph twoway (line yhat1 educ1 if gender1==1) ///
</span></span><span class="line"><span class="cl">               (line yhat1 educ1 if gender1==2), ///
</span></span><span class="line"><span class="cl">			          xline(12) legend(label(1 &#34;Men&#34;) label(2 &#34;Women&#34;)) ///
</span></span><span class="line"><span class="cl">			          xtitle(Education) ytitle(Adjusted mean)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="2-two-knots-and-two-jumps">2 Two knots and two jumps</h2>
<p><strong>This section covers piecewise regression models with two knots and two jumps interacted with a categorical variable.</strong></p>
<p>For example,income was predicted from education modeled in a piecewise fashion with two knots and two jumps at 12 and 16 years of education.Furthermore, these piecewise terms were interacted with gender.</p>
<figure style="text-align:center;">
  <img src="https://cdn.jsdelivr.net/gh/forest293/Hugo-image/2024.1.11.16.png" style="width:550px;height:350px;" alt="图片描述">
  <figcaption><strong>Piecewise regression with two knots and two jumps, labeled with estimated slopes</strong></figcaption>
</figure>
<p>The jump at 12 years of education for men is labeled as $\alpha\tiny M1$. The jump at 16 years of education for men is labeled as $\alpha\tiny M2$. These corresponding jumps for women are labeled $\alpha\tiny F1$and $\alpha\tiny F2$.</p>
<figure style="text-align:center;">
  <img src="https://cdn.jsdelivr.net/gh/forest293/Hugo-image/2024.1.11.17.png" style="width:550px;height:350px;" alt="图片描述">
  <figcaption><strong>Piecewise regression with two knots and two jumps, labeled with estimated intercepts</strong></figcaption>
</figure>
<p>Let’s now illustrate how to perform this analysis. First, the mkspline command is used to create the variables ed1, ed2, and ed3 based on the knots that are specified at 12 and 16 years of education</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  use gss_ivrm.dta
</span></span><span class="line"><span class="cl">  mkspline ed1 12 ed2 16 ed3 = educ
</span></span></code></pre></td></tr></table>
</div>
</div><p>The variables are now ready to run the piecewise regression model. The regress command, shown below,</p>
<p>includes ibn.gender used in combination with the noconstant option. This models separate intercepts for men and women. The model also includes the interaction of ibn.gender with i.hsgrad and i.cograd.</p>
<p>This models the jump in income due to graduating high school and graduating college separately for men and women.</p>
<p>Finally, the model includes the interaction of ibn.gender with c.ed1, c.ed2, and c.ed3. This models the educ slope for non–high school graduates, high school graduates, and college graduates, estimating these slopes separately for men and women. The variable i.race is included as a covariate.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  reg realrinc ibn.gender ibn.gender#(hsgrad cograd c.ed1 c.ed2 c.ed3) i.race,vce(robust) noconstant noci
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Linear regression                               Number of obs     =     32,183
                                                    F(14, 32169)      =    2602.08
                                                    Prob &gt; F          =     0.0000
                                                    R-squared         =     0.4885
                                                    Root MSE          =      24897
    
    --------------------------------------------------------
                    |               Robust
           realrinc | Coefficient  std. err.      t    P&gt;|t|
    ----------------+---------------------------------------
             gender |
              Male  |   17084.37    1389.70    12.29   0.000
            Female  |    7262.50     921.90     7.88   0.000
                    |
      gender#hsgrad |
      Male#HS Grad  |    4927.53     655.33     7.52   0.000
    Female#HS Grad  |    2400.89     372.21     6.45   0.000
                    |
      gender#cograd |
      Male#CO Grad  |    9230.72    1224.50     7.54   0.000
    Female#CO Grad  |    1615.19     789.62     2.05   0.041
                    |
       gender#c.ed1 |
              Male  |      89.40     151.40     0.59   0.555
            Female  |     243.64      98.84     2.46   0.014
                    |
       gender#c.ed2 |
              Male  |    1592.64     255.81     6.23   0.000
            Female  |    1724.74     182.70     9.44   0.000
                    |
       gender#c.ed3 |
              Male  |    4279.36     521.83     8.20   0.000
            Female  |    3608.45     496.99     7.26   0.000
                    |
               race |
             black  |   -3361.24     246.84   -13.62   0.000
             other  |   -1813.49     840.47    -2.16   0.031
    --------------------------------------------------------
</code></pre>
<figure style="text-align:center;">
  <img src="https://cdn.jsdelivr.net/gh/forest293/Hugo-image/2024.1.11.18.png" style="width:550px;height:350px;" alt="图片描述">
  <figcaption><strong></strong></figcaption>
</figure>
<p>Let’s now see how to form comparisons among these coefficients. Specifically, let’s learn how to</p>
<ul>
<li>compare slopes between men and women</li>
<li>compare slopes across the levels of education, comparing college graduates, high school graduates, and non–high school graduates</li>
<li>compare changes in slope between men and women due to graduating high school and due to graduating college</li>
<li>compare changes in intercept (the jumps in income due to graduating high school and college) by gender</li>
<li>compare changes in intercept (the jumps in income due to graduating high school and college) across levels of education</li>
</ul>
<h3 id="21-comparing-slopes-across-gender-cross-section">2.1 Comparing slopes across gender (Cross Section)</h3>
<p>Let’s begin by testing the equality of the slopes between women and men who have not graduated high school—testing whether $\beta\tiny F1$= $\beta\tiny M1$.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  contrast gender#c.ed1,pveffects nowald //slope between Men and Women (not-grad)
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Contrasts of marginal linear predictions
    
    Margins: asbalanced
    
    ----------------------------------------------------------
                      |   Contrast   Std. err.      t    P&gt;|t|
    ------------------+---------------------------------------
         gender#c.ed1 |
    (Female vs base)  |     154.25     179.30     0.86   0.390
    ----------------------------------------------------------
</code></pre>
<p>the difference in the educ slope between women and men before graduating high school is 154.25. However, this difference is not statistically significant. In other words, prior to graduating high school, the educ slope is not significantly different for men and women.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  contrast gender#c.ed2,pveffects nowald  //slope between Men and Women (grad)
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Contrasts of marginal linear predictions
    
    Margins: asbalanced
    
    ----------------------------------------------------------
                      |   Contrast   Std. err.      t    P&gt;|t|
    ------------------+---------------------------------------
         gender#c.ed2 |
    (Female vs base)  |     132.11     314.04     0.42   0.674
    ----------------------------------------------------------
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  contrast gender#c.ed3,pveffects nowald   //slope between Men and Women (grad-col)  
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Contrasts of marginal linear predictions
    
    Margins: asbalanced
    
    ----------------------------------------------------------
                      |   Contrast   Std. err.      t    P&gt;|t|
    ------------------+---------------------------------------
         gender#c.ed3 |
    (Female vs base)  |    -670.91     721.07    -0.93   0.352
    ----------------------------------------------------------
</code></pre>
<h3 id="22-comparing-slopes-across-education">2.2 Comparing slopes across education</h3>
<p>Let’s begin by comparing the slopes for high school graduates with non–high school graduates, starting with men. testing whether $\beta\tiny M2$ = $\beta\tiny M1$  .</p>
<p><strong>comparing the slopes for high school graduates with non-high school graduates (Men).</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  lincom 1.gender#c.ed2 - 1.gender#c.ed1   
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>     ( 1)  - 1bn.gender#c.ed1 + 1bn.gender#c.ed2 = 0
    
    ------------------------------------------------------------------------------
        realrinc | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
    -------------+----------------------------------------------------------------
             (1) |    1503.24     297.13     5.06   0.000       920.85     2085.63
    ------------------------------------------------------------------------------
</code></pre>
<p><strong>comparing the slopes for high school graduates with non-high school graduates (Women).</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  lincom 2.gender#c.ed2 - 2.gender#c.ed1
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>     ( 1)  - 2.gender#c.ed1 + 2.gender#c.ed2 = 0
    
    ------------------------------------------------------------------------------
        realrinc | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
    -------------+----------------------------------------------------------------
             (1) |    1481.10     208.81     7.09   0.000      1071.82     1890.38
    ------------------------------------------------------------------------------
</code></pre>
<p><strong>Men : cograd vs. hsgrad</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  lincom 1.gender#c.ed3 - 1.gender#c.ed2
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>     ( 1)  - 1bn.gender#c.ed2 + 1bn.gender#c.ed3 = 0
    
    ------------------------------------------------------------------------------
        realrinc | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
    -------------+----------------------------------------------------------------
             (1) |    2686.72     581.27     4.62   0.000      1547.41     3826.03
    ------------------------------------------------------------------------------
</code></pre>
<p><strong>Women : cograd vs. hsgrad</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  lincom 2.gender#c.ed3 - 2.gender#c.ed2
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>     ( 1)  - 2.gender#c.ed2 + 2.gender#c.ed3 = 0
    
    ------------------------------------------------------------------------------
        realrinc | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
    -------------+----------------------------------------------------------------
             (1) |    1883.71     530.20     3.55   0.000       844.49     2922.93
    ------------------------------------------------------------------------------
</code></pre>
<h3 id="23-difference-in-differences-of-slopes">2.3 Difference in differences of slopes</h3>
<p>Let’s now test the gain in slope due to graduating high school for men compared with the gain in slope due to graduating high school for women, which is ($\beta\tiny M2$ -  $\beta\tiny M1$) -($\beta\tiny F2$ -  $\beta\tiny F1$)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  lincom (1.gender#c.ed2 - 1.gender#c.ed1) - (2.gender#c.ed2 - 2.gender#c.ed1)
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>     ( 1)  - 1bn.gender#c.ed1 + 2.gender#c.ed1 + 1bn.gender#c.ed2 - 2.gender#c.ed2 = 0
    
    ------------------------------------------------------------------------------
        realrinc | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
    -------------+----------------------------------------------------------------
             (1) |      22.14     361.97     0.06   0.951      -687.33      731.61
    ------------------------------------------------------------------------------
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  lincom (1.gender#c.ed3 - 1.gender#c.ed2) - (2.gender#c.ed3 - 2.gender#c.ed2)
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>     ( 1)  - 1bn.gender#c.ed2 + 2.gender#c.ed2 + 1bn.gender#c.ed3 - 2.gender#c.ed3 = 0
    
    ------------------------------------------------------------------------------
        realrinc | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
    -------------+----------------------------------------------------------------
             (1) |     803.01     786.64     1.02   0.307      -738.84     2344.87
    ------------------------------------------------------------------------------
</code></pre>
<h3 id="24-comparing-changes-in-intercepts-by-gender">2.4 Comparing changes in intercepts by gender</h3>
<p>Let’s now ask whether the jump in income at 12 years of education is the same for men and women.</p>
<p>Let’s test whether these jumps are equal (whether $\alpha\tiny F1$= $\alpha\tiny M1$ ).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  contrast gender#hsgrad,pveffects nowald 
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Contrasts of marginal linear predictions
    
    Margins: asbalanced
    
    ----------------------------------------------------------------------------
                                        |   Contrast   Std. err.      t    P&gt;|t|
    ------------------------------------+---------------------------------------
                          gender#hsgrad |
    (Female vs base) (HS Grad vs base)  |   -2526.64     752.53    -3.36   0.001
    ----------------------------------------------------------------------------
</code></pre>
<p><strong>test whether these jump are equal(αF2=αM2？)</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  contrast gender#cograd,pveffects nowald 
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Contrasts of marginal linear predictions
    
    Margins: asbalanced
    
    ----------------------------------------------------------------------------
                                        |   Contrast   Std. err.      t    P&gt;|t|
    ------------------------------------+---------------------------------------
                          gender#cograd |
    (Female vs base) (CO Grad vs base)  |   -7615.52    1455.05    -5.23   0.000
    ----------------------------------------------------------------------------
</code></pre>
<h3 id="25-comparing-changes-in-intercepts-by-education">2.5 Comparing changes in intercepts by education</h3>
<p>We might ask whether the jump due to graduating college ($9,230.72$) is equal to the jump due to graduating high school ($4,927.53$).</p>
<p><strong>whether the jump due to graduating college is equal to the jump due to graduating high school(Men)</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  lincom 1.gender#1.cograd - 1.gender#1.hsgrad
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>     ( 1)  - 1bn.gender#1.hsgrad + 1bn.gender#1.cograd = 0
    
    ------------------------------------------------------------------------------
        realrinc | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
    -------------+----------------------------------------------------------------
             (1) |    4303.19    1327.65     3.24   0.001      1700.93     6905.44
    ------------------------------------------------------------------------------
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  lincom 2.gender#1.cograd - 2.gender#1.hsgrad
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>     ( 1)  - 2.gender#1.hsgrad + 2.gender#1.cograd = 0
    
    ------------------------------------------------------------------------------
        realrinc | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
    -------------+----------------------------------------------------------------
             (1) |    -785.70     831.22    -0.95   0.345     -2414.92      843.52
    ------------------------------------------------------------------------------
</code></pre>
<h3 id="26-computing-and-comparing-adjusted-means">2.6 Computing and comparing adjusted means</h3>
<p>Let’s now see how to compute adjusted means in the context of this model. To compute adjusted means with respect to education, we need to express education in terms of hsgrad, cograd, ed1, ed2, and ed3.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  showcoding educ hsgrad cograd ed1 ed2 ed3
</span></span></code></pre></td></tr></table>
</div>
</div><figure style="text-align:center;">
  <img src="https://cdn.jsdelivr.net/gh/forest293/Hugo-image/2024.1.11.19.png" style="width:350px;height:450px;" alt="图片描述">
  <figcaption><strong></strong></figcaption>
</figure>
<p>We can estimate the adjusted mean for men and women (separately) in one margins command.</p>
<p><strong>hoding education constant at 15-years of education</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  margins gender,nopvalues at(hsgrad=1 cograd=0 ed1=12 ed2=3 ed3=0)
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Predictive margins                                      Number of obs = 32,183
    Model VCE: Robust
    
    Expression: Linear prediction, predict()
    At: hsgrad =  1
        cograd =  0
        ed1    = 12
        ed2    =  3
        ed3    =  0
    
    --------------------------------------------------------------
                 |            Delta-method
                 |     Margin   std. err.     [95% conf. interval]
    -------------+------------------------------------------------
          gender |
           Male  |   27322.43     652.72      26043.07    28601.78
         Female  |   17221.21     488.53      16263.68    18178.75
    --------------------------------------------------------------
</code></pre>
<p>Let’s now use the margins command to compare the adjusted mean of income for women versus men among those with 15 years of education. Specifying the r. contrast operator indicates we want to use reference group comparisons.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  margins r.gender,at(hsgrad=1 cograd=0 ed1=12 ed2=3 ed3=0)
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Contrasts of predictive margins                         Number of obs = 32,183
    Model VCE: Robust
    
    Expression: Linear prediction, predict()
    At: hsgrad =  1
        cograd =  0
        ed1    = 12
        ed2    =  3
        ed3    =  0
    
    ------------------------------------------------
                 |         df           F        P&gt;F
    -------------+----------------------------------
          gender |          1      154.10     0.0000
                 |
     Denominator |      32169
    ------------------------------------------------
    
    -------------------------------------------------------------------
                      |            Delta-method
                      |   Contrast   std. err.     [95% conf. interval]
    ------------------+------------------------------------------------
               gender |
    (Female vs Male)  |  -10101.21     813.72     -11696.14    -8506.28
    -------------------------------------------------------------------
</code></pre>
<p>at 15 years of education, the adjusted mean of income for men is $10,101.21$ higher than for women.</p>
<h3 id="27-graphing-adjusted-means">2.7 Graphing adjusted means</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  margins gender,at(hsgrad=0 cograd=0 ed1=0 ed2=0 ed3=0) ///
</span></span><span class="line"><span class="cl">                 at(hsgrad=0 cograd=0 ed1=12 ed2=0 ed3=0) ///
</span></span><span class="line"><span class="cl">				         at(hsgrad=1 cograd=0 ed1=12 ed2=0 ed3=0) ///
</span></span><span class="line"><span class="cl">				         at(hsgrad=1 cograd=0 ed1=12 ed2=4 ed3=0) ///
</span></span><span class="line"><span class="cl">				         at(hsgrad=1 cograd=1 ed1=12 ed2=4 ed3=0) ///
</span></span><span class="line"><span class="cl">				         at(hsgrad=1 cograd=1 ed1=12 ed2=4 ed3=4) 
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    Predictive margins                                      Number of obs = 32,183
    Model VCE: Robust
    
    Expression: Linear prediction, predict()
    1._at: hsgrad =  0
           cograd =  0
           ed1    =  0
           ed2    =  0
           ed3    =  0
    2._at: hsgrad =  0
           cograd =  0
           ed1    = 12
           ed2    =  0
           ed3    =  0
    3._at: hsgrad =  1
           cograd =  0
           ed1    = 12
           ed2    =  0
           ed3    =  0
    4._at: hsgrad =  1
           cograd =  0
           ed1    = 12
           ed2    =  4
           ed3    =  0
    5._at: hsgrad =  1
           cograd =  1
           ed1    = 12
           ed2    =  4
           ed3    =  0
    6._at: hsgrad =  1
           cograd =  1
           ed1    = 12
           ed2    =  4
           ed3    =  4
    
    ------------------------------------------------------------------------------
                 |            Delta-method
                 |     Margin   std. err.      t    P&gt;|t|     [95% conf. interval]
    -------------+----------------------------------------------------------------
      _at#gender |
         1#Male  |   16544.24    1384.77    11.95   0.000     13830.04    19258.45
       1#Female  |    6722.38     909.92     7.39   0.000      4938.90     8505.85
         2#Male  |   17616.99     590.89    29.81   0.000     16458.82    18775.15
       2#Female  |    9646.09     345.63    27.91   0.000      8968.64    10323.54
         3#Male  |   22544.52     282.66    79.76   0.000     21990.49    23098.54
       3#Female  |   12046.99     142.20    84.72   0.000     11768.27    12325.71
         4#Male  |   28915.06     896.20    32.26   0.000     27158.47    30671.66
       4#Female  |   18945.96     667.08    28.40   0.000     17638.46    20253.45
         5#Male  |   38145.78     830.91    45.91   0.000     36517.16    39774.40
       5#Female  |   20561.15     422.35    48.68   0.000     19733.33    21388.97
         6#Male  |   55263.21    1736.33    31.83   0.000     51859.94    58666.48
       6#Female  |   34994.95    1760.66    19.88   0.000     31543.99    38445.92
    ------------------------------------------------------------------------------
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  preserve 
</span></span><span class="line"><span class="cl">  clear
</span></span><span class="line"><span class="cl">  input educ yhatm yhatf
</span></span><span class="line"><span class="cl">   0 16544.24 6722.377
</span></span><span class="line"><span class="cl">  12 17616.99 9646.094
</span></span><span class="line"><span class="cl">  12 22544.52 12046.99
</span></span><span class="line"><span class="cl">  16 28915.06 18945.96
</span></span><span class="line"><span class="cl">  16 38145.78 20561.15
</span></span><span class="line"><span class="cl">  20 55263.21 34994.95
</span></span><span class="line"><span class="cl">  end
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  graph twoway line yhatm yhatf educ,xlabel(0(4)20) xline(12 16)
</span></span><span class="line"><span class="cl">  restore
</span></span></code></pre></td></tr></table>
</div>
</div><figure style="text-align:center;">
  <img src="https://cdn.jsdelivr.net/gh/forest293/Hugo-image/2024.1.11.20.png" style="width:650px;height:450px;" alt="图片描述">
  <figcaption><strong>Fitted values from piecewise model with two knots and two jumps</strong></figcaption>
</figure>
<p><strong>Automate the creation of the graph</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  *First,rerun the -margins- command from above
</span></span><span class="line"><span class="cl">  quietly margins gender,at(hsgrad=0 cograd=0 ed1=0 ed2=0 ed3=0) ///
</span></span><span class="line"><span class="cl">                         at(hsgrad=0 cograd=0 ed1=12 ed2=0 ed3=0) ///
</span></span><span class="line"><span class="cl">				                 at(hsgrad=1 cograd=0 ed1=12 ed2=0 ed3=0) ///
</span></span><span class="line"><span class="cl">				                 at(hsgrad=1 cograd=0 ed1=12 ed2=4 ed3=0) ///
</span></span><span class="line"><span class="cl">				                 at(hsgrad=1 cograd=1 ed1=12 ed2=4 ed3=0) ///
</span></span><span class="line"><span class="cl">				                 at(hsgrad=1 cograd=1 ed1=12 ed2=4 ed3=4) ///
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  *Store the adjusted means(from the -margins- command) in a matrix named -yhat-
</span></span><span class="line"><span class="cl">  matrix yhat = r(b)&#39; //note: we must transpose r(b) here
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  *Store levels of education in a matrix named -educ-
</span></span><span class="line"><span class="cl">  matrix educ = (0\0\12\12\12\12\16\16\16\16\20\20) 
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  *Store levels of gender in a matrix named -gender-
</span></span><span class="line"><span class="cl">  matrix gender = (1\2\1\2\1\2\1\2\1\2\1\2)
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  svmat yhat  //save the matrix -yhat- to the current dataset
</span></span><span class="line"><span class="cl">  svmat educ  //save the matrix -educ- to the current dataset 
</span></span><span class="line"><span class="cl">  svmat gender //save the matrix -gender- to the current dataset
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  graph twoway (line yhat1 educ1 if gender1==1) ///
</span></span><span class="line"><span class="cl">               (line yhat1 educ1 if gender1==2), ///
</span></span><span class="line"><span class="cl">               xline(12 16) legend(label(1 &#34;Men&#34;) label(2 &#34;Women&#34;)) ///
</span></span><span class="line"><span class="cl">			         xtitle(Education) ytitle(Adjusted mean)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="3-comparing-coding-schemes">3 Comparing coding schemes</h2>
<p>This chapter has focused on one coding scheme for fitting models that interact a categorical variable and a continuous variable fit in a piecewise manner.Depending on your research question, another coding scheme might be more useful.</p>
<h3 id="31-coding-scheme-1">3.1 Coding scheme #1</h3>
<p>This coding scheme will be called coding scheme #1. The noheader option is used in this and subsequent examples to save space.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  use gss_ivrm.dta
</span></span><span class="line"><span class="cl">  mkspline ed1 12 ed2 = educ
</span></span><span class="line"><span class="cl">  reg realrinc ibn.gender ibn.gender#(i.hsgrad c.ed1 c.ed2) i.race,vce(robust) noconstant noheader noci
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    --------------------------------------------------------
                    |               Robust
           realrinc | Coefficient  std. err.      t    P&gt;|t|
    ----------------+---------------------------------------
             gender |
              Male  |   17144.66    1389.51    12.34   0.000
            Female  |    7325.48     922.52     7.94   0.000
                    |
      gender#hsgrad |
      Male#HS Grad  |    3382.00     661.55     5.11   0.000
    Female#HS Grad  |    1748.10     389.36     4.49   0.000
                    |
       gender#c.ed1 |
              Male  |      86.71     151.38     0.57   0.567
            Female  |     241.61      98.92     2.44   0.015
                    |
       gender#c.ed2 |
              Male  |    4057.64     150.38    26.98   0.000
            Female  |    2529.55     110.43    22.91   0.000
                    |
               race |
             black  |   -3521.34     246.66   -14.28   0.000
             other  |   -1946.16     839.73    -2.32   0.020
    --------------------------------------------------------
</code></pre>
<figure style="text-align:center;">
  <img src="https://cdn.jsdelivr.net/gh/forest293/Hugo-image/2024.1.12.png" style="width:650px;height:450px;" alt="图片描述">
  <figcaption><strong>Intercept and slope coefficients from piecewise regression fit using coding scheme #1</strong></figcaption>
</figure>
<h3 id="32-coding-scheme-2">3.2 Coding scheme #2</h3>
<p>Let’s now fit a model using what I call coding scheme #2. This coding scheme is the same as coding scheme #1, except that the marginal option is used on the mkspline command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  use gss_ivrm.dta
</span></span><span class="line"><span class="cl">  mkspline ed1m 12 ed2m = educ,marginal
</span></span><span class="line"><span class="cl">  reg realrinc ibn.gender ibn.gender#(i.hsgrad c.ed1m c.ed2m) i.race,vce(robust) noconstant noheader noci
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    --------------------------------------------------------
                    |               Robust
           realrinc | Coefficient  std. err.      t    P&gt;|t|
    ----------------+---------------------------------------
             gender |
              Male  |   17144.66    1389.51    12.34   0.000
            Female  |    7325.48     922.52     7.94   0.000
                    |
      gender#hsgrad |
      Male#HS Grad  |    3382.00     661.55     5.11   0.000
    Female#HS Grad  |    1748.10     389.36     4.49   0.000
                    |
      gender#c.ed1m |
              Male  |      86.71     151.38     0.57   0.567
            Female  |     241.61      98.92     2.44   0.015
                    |
      gender#c.ed2m |
              Male  |    3970.93     212.70    18.67   0.000
            Female  |    2287.94     147.26    15.54   0.000
                    |
               race |
             black  |   -3521.34     246.66   -14.28   0.000
             other  |   -1946.16     839.73    -2.32   0.020
    --------------------------------------------------------
</code></pre>
<figure style="text-align:center;">
  <img src="https://cdn.jsdelivr.net/gh/forest293/Hugo-image/2024.1.12.1.png" style="width:650px;height:450px;" alt="图片描述">
  <figcaption><strong>Summary of regression results and meaning of coefficients for coding schemes #1 and #2</strong></figcaption>
</figure>
<p>You can see that the only difference is in the final row of the table. Coding scheme #1 estimates $\beta\tiny M2$ and $\beta\tiny F2$, whereas coding scheme #2 estimates ($\beta\tiny M2$-$\beta\tiny M1$)and ($\beta\tiny F2$-$\beta\tiny F1$).</p>
<h3 id="33-coding-scheme-3">3.3 Coding scheme #3</h3>
<p>This coding scheme is like coding scheme #1, in that the marginal option is omitted from the mkspline command. Unlike coding scheme #1, coding scheme #3 specifies i.gender (instead of ibn.gender) and omits the noconstant option</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  use gss_ivrm.dta
</span></span><span class="line"><span class="cl">  mkspline ed1 12 ed2 = educ
</span></span><span class="line"><span class="cl">  reg realrinc i.gender##(i.hsgrad c.ed1 c.ed2) i.race,vce(robust) noheader noci
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    --------------------------------------------------------
                    |               Robust
           realrinc | Coefficient  std. err.      t    P&gt;|t|
    ----------------+---------------------------------------
             gender |
            Female  |   -9819.17    1638.56    -5.99   0.000
                    |
             hsgrad |
           HS Grad  |    3382.00     661.55     5.11   0.000
                ed1 |      86.71     151.38     0.57   0.567
                ed2 |    4057.64     150.38    26.98   0.000
                    |
      gender#hsgrad |
    Female#HS Grad  |   -1633.91     766.98    -2.13   0.033
                    |
       gender#c.ed1 |
            Female  |     154.90     179.32     0.86   0.388
                    |
       gender#c.ed2 |
            Female  |   -1528.09     187.09    -8.17   0.000
                    |
               race |
             black  |   -3521.34     246.66   -14.28   0.000
             other  |   -1946.16     839.73    -2.32   0.020
                    |
              _cons |   17144.66    1389.51    12.34   0.000
    --------------------------------------------------------
</code></pre>
<h3 id="34-coding-scheme-4">3.4 Coding scheme #4</h3>
<p>Finally, let’s consider a fourth coding scheme. This coding scheme is like coding scheme #3, except that the marginal option is included on the mkspline command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  use gss_ivrm.dta
</span></span><span class="line"><span class="cl">  mkspline ed1m 12 ed2m = educ,marginal
</span></span><span class="line"><span class="cl">  reg realrinc i.gender##(i.hsgrad c.ed1m c.ed2m) i.race,vce(robust) noheader noci
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>    --------------------------------------------------------
                    |               Robust
           realrinc | Coefficient  std. err.      t    P&gt;|t|
    ----------------+---------------------------------------
             gender |
            Female  |   -9819.17    1638.56    -5.99   0.000
                    |
             hsgrad |
           HS Grad  |    3382.00     661.55     5.11   0.000
               ed1m |      86.71     151.38     0.57   0.567
               ed2m |    3970.93     212.70    18.67   0.000
                    |
      gender#hsgrad |
    Female#HS Grad  |   -1633.91     766.98    -2.13   0.033
                    |
      gender#c.ed1m |
            Female  |     154.90     179.32     0.86   0.388
                    |
      gender#c.ed2m |
            Female  |   -1682.99     259.29    -6.49   0.000
                    |
               race |
             black  |   -3521.34     246.66   -14.28   0.000
             other  |   -1946.16     839.73    -2.32   0.020
                    |
              _cons |   17144.66    1389.51    12.34   0.000
    --------------------------------------------------------
</code></pre>
<figure style="text-align:center;">
  <img src="https://cdn.jsdelivr.net/gh/forest293/Hugo-image/2024.1.12.2.png" style="width:650px;height:450px;" alt="图片描述">
  <figcaption><strong>Summary of regression results and meaning of coefficients for coding schemes #3 and #4</strong></figcaption>
</figure>
<p>In comparing coding schemes #3 and #4, the only difference is in the final row of the table. Coding scheme #3 estimates $\beta\tiny MM2$ and ($\beta\tiny F2$-$\beta\tiny M2$). By comparison, coding scheme #4 estimates ($\beta\tiny M2$-$\beta\tiny M1$) and($\beta\tiny F2$-$\beta\tiny F1$)-($\beta\tiny M2$-$\beta\tiny M1$) .</p>
<h3 id="35-choosing-coding-schemes">3.5 Choosing coding schemes</h3>
<p>We can deliberately choose the coding scheme that might make the most sense given our research question.</p>
<p>Say that the emphasis of your research study was to test gender differences in the educ slope among high school graduates (that is,$\beta\tiny F2$-$\beta\tiny M2$). In that case, coding scheme #3 might be the most useful, <strong>because the coefficient associated with gender#ed2 directly estimates this difference ($\beta\tiny F2$-$\beta\tiny M2$).</strong> Had you chosen coding scheme #1, you could still estimate this difference, but would need to also use the contrast gender#c.ed1 command to compute this difference.</p>
<p>Instead, imagine that your research question focused on gender differences in the educ slope for high school graduates versus non–high school graduates. In that case, coding system #4 might be the most useful because the coefficient associated with gender#ed2m directly estimates this difference ($\beta\tiny F2$-$\beta\tiny F1$)-($\beta\tiny M2$-$\beta\tiny M1$).</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2024-01-11</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/12.chapter12piecewise-by-categorical-interactions/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/interaction/">Interaction</a>,&nbsp;<a href="/tags/stata/">stata</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/13.chapter13continuous-by-continuous-by-categorical-interactions/" class="prev" rel="prev" title="Chapter13 ：Continuous by continuous by categorical interactions"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Chapter13 ：Continuous by continuous by categorical interactions</a>
            <a href="/16.chapter16time-as-a-continuous-predictor/" class="next" rel="next" title="Chapter16 ：Time as a continuous predictor">Chapter16 ：Time as a continuous predictor<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2023 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Alex_Wang</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/valine@1.5.0/dist/Valine.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"comment":{"valine":{"appId":"QGzwQXOqs5JOhN4RGPOkR2mR-MdYXbMMI","appKey":"WBmoGyJtbqUswvfLh6L8iEBr","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"zh-CN","pageSize":10,"placeholder":"你的评论 ...","recordIP":true,"serverURLs":"https://leancloud.hugoloveit.com","visitor":true}},"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.zh-cn","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
